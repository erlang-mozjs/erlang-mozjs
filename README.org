* erlang-mozjs
** Overview

   [[http://travis-ci.org/erlang-mozjs/erlang-mozjs][Travis-CI]] :: [[https://secure.travis-ci.org/erlang-mozjs/erlang-mozjs.png]]

   =erlang-mozjs= is a NIF library, and API that embeds Mozilla's Spidermonkey
   Javascript Virtual Machine in Erlang. Originally created to facilitate usage
   of Riak's MapReduce by non-Erlang programmers, it supports multiple
   concurrent Javascript VMs, runtime evaluation of Javascript code, and
   invocation of Javascript functions.

   =erlang-mozjs= builds and executes only on Unix-based platforms, including
   Linux, Mac OS/X, and Solaris. It requires Spidermonkey 52 and includes [[https://crockford.com][Douglas
   Crockford]]'s [[https://github.com/douglascrockford/JSON-js][json2.js]] JSON parser. More information about the features
   available to Javascript inside =erlang-mozjs= are detailed on the
   [[https://developer.mozilla.org/en/JavaScript/Reference][Mozilla Developer Center]].

** Quick Start
   You must have [[http://erlang.org/download.html][Erlang/OTP 18]] or later and a GNU-style make
   system to compile and run =erlang-mozjs=.

#+BEGIN_SRC shell
git clone git://github.com/erlang-mozjs/erlang-mozjs.git
make all test
#+END_SRC

   Start up an Erlang shell with the path to =erlang-mozjs= included.

#+BEGIN_SRC shell
erl -pa path/to/erlang-mozjs/ebin -boot start_sasl
#+END_SRC

   Create a Javascript VM.
#+BEGIN_SRC erlang
1> {ok, JS} = js_driver:new().
{ok,#Ref<0.557298074.1409679362.105432>}
#+END_SRC

   Now you can evaluate Javascript expressions and call Javascript
   functions.

#+BEGIN_SRC erlang
2> js:define(JS, <<"var addOne = function(a){ return a + 1; }">>).
ok
3> js:call(JS, <<"addOne">>, [3]).
{ok,4}
#+END_SRC

   Release JS resource when no longer needed.
#+BEGIN_SRC erlang
4> js_driver:destroy(JS).
ok
#+END_SRC

** Documentation
   Documentation about the API is extensive and can be generated by
   =edoc=.

#+BEGIN_SRC shell
$ make docs
$ open docs/index.html
#+END_SRC

** Contributing
   We encourage contributions to =erlang-mozjs= from the community.

   1) Fork the =erlang-mozjs= repository on [[https://github.com/erlang-mozjs/erlang-mozjs][Github]].
   2) Clone your fork or add the remote if you already have a clone of
      the repository.
#+BEGIN_SRC shell
git clone git@github.com:yourusername/erlang-mozjs.git
# or
git remote add mine git@github.com:yourusername/erlang-mozjs.git
#+END_SRC
   3) Create a topic branch for your change.
#+BEGIN_SRC shell
git checkout -b some-topic-branch
#+END_SRC
   4) Make your change and commit. Use a clear and descriptive commit
      message, spanning multiple lines if detailed explanation is
      needed.
   5) Push to your fork of the repository and then send a pull-request
      through Github.
#+BEGIN_SRC shell
git push mine some-topic-branch
#+END_SRC
   6) A community maintainer will review your patch and merge it into the main
      repository or send you feedback.
